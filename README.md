# Rugby Stats Board - Electronアプリ

ラグビーの試合スタッツをデュアルディスプレイで表示するElectronデスクトップアプリケーションです。

## 機能

- **デュアルディスプレイ対応**: 1台のPCで管理画面と表示画面を別々のモニターに表示
- **リアルタイム同期**: 管理画面での編集が即座に表示画面に反映
- **CSV選手データ読み込み**: チーム選手情報をCSVファイルから簡単に取り込み
- **外部データ取り込み機能**: Excel/CSVファイルから選手情報を柔軟にインポート（カラムマッピング対応）
- **画像パス自動生成**: 選手写真・チームロゴのパスを自動的に生成・補完
- **スコア・統計管理**: 得点、トライ数、コンバージョン数、ペナルティゴール数を管理
- **選手交代管理**: 試合中の選手交代を記録・表示
- **プロフェッショナルデザイン**: 黒背景に大きなチームロゴを配置した放送品質のデザイン

## 必要な環境

- **Node.js**: バージョン 16.x 以上推奨
- **npm**: Node.jsに付属
- **OS**: Windows 10/11, macOS 10.14+, または Linux

## インストール手順

### 1. Node.jsのインストール

https://nodejs.org/ から最新のLTS版をダウンロードしてインストールしてください。

### 2. プロジェクトのセットアップ

```bash
# プロジェクトディレクトリに移動
cd rugby-stats-app

# 依存パッケージのインストール
npm install
```

## 使用方法

### アプリケーションの起動

```bash
npm start
```

起動すると以下の2つのウィンドウが開きます：
- **管理画面**: メインモニターに表示される操作画面
- **表示画面**: サブモニター（または同じモニター）に全画面表示される観客向け画面

### CSV選手データの形式

選手データは以下の形式のCSVファイルで準備してください：

```csv
背番号,名前,ポジション
1,山田太郎,プロップ
2,田中一郎,フッカー
3,佐藤次郎,プロップ
...
```

サンプルファイル `sample_team.csv` を参考にしてください。

### 基本操作

1. **チーム情報の設定**
   - チーム名、ロゴURL、チームカラーを入力

2. **選手データの読み込み**
   - 「CSV読み込み」ボタンをクリック
   - 各チームのCSVファイルを選択

3. **試合中の操作**
   - スコア、トライ数などを入力すると自動的に表示画面に反映
   - 選手交代も管理画面から記録可能

4. **表示画面の制御**
   - 「表示画面 ON/OFF」ボタンで表示画面を開閉
   - F11キーで全画面表示の切り替え（ブラウザウィンドウ内）

### 外部データ取り込み機能（Issue #3, #4対応）

チームから提供されるExcel/CSVファイルを、システム形式に自動変換してインポートできます。

#### 使用方法

1. **マッパーウィンドウを開く**
   - 管理画面の「📊 外部データ取り込み」ボタンをクリック

2. **ファイルをアップロード**
   - Excel (.xlsx, .xls) または CSV (.csv) ファイルをドラッグ&ドロップ
   - データプレビューが表示されます

3. **カラムマッピングを設定**
   - アップロードファイルの列名とシステム項目を対応付けます
   - 例: 「氏名」→「選手名」、「背番号」→「背番号」、「Pos」→「ポジション」

4. **画像パス自動生成（オプション）**
   - ☑ 選手写真のパスを自動生成
     - ベースパス: `./assets/players/`
     - パターン: `{JerseyNo}.jpg`（背番号を使用）
   - ☑ チームロゴのパスを自動生成
     - ベースパス: `./assets/logos/`
     - パターン: `{TeamName}_logo.png`

5. **インポート実行**
   - 「インポート実行」ボタンをクリック
   - 変換されたデータがシステムに取り込まれます

#### プリセット機能

よく使うマッピング設定をプリセットとして保存できます：
- **保存**: 「現在の設定を保存」ボタンからプリセット名を入力して保存
- **適用**: プリセット選択ドロップダウンから選んで「プリセット適用」

#### サンプルデータ

`sample_external_data.csv` を参考にしてください：
```csv
氏名,背番号,Pos,身長,体重
稲垣啓太,1,PR,186,115
堀江翔太,2,HO,180,104
...
```

このファイルをアップロードし、以下のようにマッピング：
- 氏名 → 選手名
- 背番号 → 背番号
- Pos → ポジション
- 身長・体重 → マッピングしない

## アプリケーションのビルド

実行可能ファイルを作成する場合：

```bash
# Windows用
npm run build:win

# macOS用
npm run build:mac

# Linux用
npm run build:linux
```

ビルドされたファイルは `dist` フォルダに生成されます。

## ファイル構成

```
rugby-stats-app/
├── main.js                      # Electronメインプロセス
├── preload.js                   # プリロードスクリプト（IPC通信）
├── control.html                 # 管理画面UI
├── mapper.html                  # データマッピング画面UI（NEW）
├── display.html                 # 表示画面UI
├── package.json                 # プロジェクト設定
├── sample_team.csv              # サンプル選手データ（標準形式）
├── sample_team_with_logo.csv    # サンプル選手データ（ロゴ付き）
├── sample_external_data.csv     # サンプル外部データ（マッピング用）
├── presets/                     # マッピングプリセット保存フォルダ
│   ├── default.json
│   └── ...
└── README.md                    # このファイル
```

## トラブルシューティング

### 表示画面が表示されない
- 管理画面の「表示画面 ON/OFF」ボタンをクリックして再表示してください
- デュアルディスプレイが認識されていない場合、メインモニターに表示されます

### CSVが読み込めない
- CSVファイルがUTF-8エンコーディングで保存されているか確認してください
- フォーマットが「背番号,名前,ポジション」の形式になっているか確認してください

### 同期が動作しない
- アプリを再起動してください
- ブラウザの開発者ツール（Ctrl+Shift+I / Cmd+Option+I）でエラーを確認してください

## カスタマイズ

### デザインの変更
- `display.html` のCSSセクションを編集してデザインをカスタマイズできます

### データ構造の拡張
- `main.js` の `matchData` オブジェクトに新しいフィールドを追加できます

## ライセンス

MIT License

## 開発者向け情報

### 開発モードでの実行
```bash
npm start
```

### デバッグ
管理画面・表示画面それぞれで開発者ツールを開くには：
- Windows/Linux: `Ctrl + Shift + I`
- macOS: `Cmd + Option + I`

### IPC通信
- `main.js`: IPC通信のハンドラー定義
- `preload.js`: レンダラープロセスに安全なAPIを公開
- HTML ファイル: `window.electronAPI` 経由でメインプロセスと通信
