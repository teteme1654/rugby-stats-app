<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rugby Stats - ç®¡ç†ç”»é¢</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      color: white;
      text-align: center;
      margin-bottom: 30px;
      font-size: 2.5em;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .control-panel {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      margin-bottom: 20px;
    }

    .section-title {
      font-size: 1.5em;
      color: #667eea;
      margin-bottom: 20px;
      border-bottom: 3px solid #667eea;
      padding-bottom: 10px;
    }

    .teams-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }

    .team-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      border: 2px solid #e0e0e0;
    }

    .team-section h3 {
      margin-bottom: 15px;
      color: #333;
      font-size: 1.3em;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #555;
    }

    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 5px;
      font-size: 1em;
      transition: border-color 0.3s;
    }

    input:focus {
      outline: none;
      border-color: #667eea;
    }

    .score-input {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }

    .score-input input {
      text-align: center;
      font-size: 1.2em;
      font-weight: bold;
    }

    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1em;
      font-weight: bold;
      transition: all 0.3s;
      margin-right: 10px;
    }

    button:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    button.secondary {
      background: #6c757d;
    }

    button.secondary:hover {
      background: #5a6268;
    }

    .csv-section {
      margin-top: 20px;
    }

    .players-list {
      max-height: 300px;
      overflow-y: auto;
      background: white;
      border: 2px solid #ddd;
      border-radius: 5px;
      padding: 10px;
      margin-top: 10px;
    }

    .player-item {
      padding: 8px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
    }

    .player-item:last-child {
      border-bottom: none;
    }

    .player-number {
      font-weight: bold;
      color: #667eea;
      margin-right: 10px;
    }

    .substitution-section {
      background: #fff3cd;
      padding: 20px;
      border-radius: 10px;
      border: 2px solid #ffc107;
    }

    .sub-controls {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 10px;
      align-items: end;
    }

    .quick-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      justify-content: center;
    }

    .action-btn {
      padding: 15px 30px;
      font-size: 1.1em;
    }

    .status-bar {
      background: #28a745;
      color: white;
      padding: 10px;
      border-radius: 5px;
      text-align: center;
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ‰ Rugby Stats Board - ç®¡ç†ç”»é¢</h1>

    <!-- å‰åŠ/å¾ŒåŠåˆ‡ã‚Šæ›¿ãˆ -->
    <div class="control-panel">
      <h2 class="section-title">è©¦åˆé€²è¡Œ</h2>
      <div style="display: flex; gap: 20px; align-items: center; justify-content: center;">
        <button id="halfBtn1" onclick="switchHalf('first')" style="padding: 15px 40px; font-size: 1.2em; background: #667eea;">å‰åŠ</button>
        <button id="halfBtn2" onclick="switchHalf('second')" style="padding: 15px 40px; font-size: 1.2em; background: #6c757d;">å¾ŒåŠ</button>
        <div style="margin-left: 20px;">
          <strong>ç¾åœ¨:</strong> <span id="currentHalfDisplay">å‰åŠ</span>
        </div>
      </div>
      <div style="margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
          <h3>å‰åŠã‚¹ã‚³ã‚¢</h3>
          <div style="font-size: 2em; font-weight: bold; margin-top: 10px;">
            <span id="hostFirstHalfScore">0</span> - <span id="awayFirstHalfScore">0</span>
          </div>
        </div>
        <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
          <h3>å¾ŒåŠã‚¹ã‚³ã‚¢</h3>
          <div style="font-size: 2em; font-weight: bold; margin-top: 10px;">
            <span id="hostSecondHalfScore">0</span> - <span id="awaySecondHalfScore">0</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ãƒãƒ¼ãƒ æƒ…å ±ãƒ»ã‚¹ã‚³ã‚¢ -->
    <div class="control-panel">
      <h2 class="section-title">ãƒãƒ¼ãƒ æƒ…å ±ãƒ»ã‚¹ã‚³ã‚¢</h2>
      <div class="teams-container">
        <!-- ãƒ›ãƒ¼ãƒ ãƒãƒ¼ãƒ  -->
        <div class="team-section">
          <h3>ãƒ›ãƒ¼ãƒ ãƒãƒ¼ãƒ </h3>
          <div class="form-group">
            <label>ãƒãƒ¼ãƒ å:</label>
            <input type="text" id="hostTeamName" placeholder="ãƒãƒ¼ãƒ åã‚’å…¥åŠ›">
          </div>
          <div class="form-group">
            <label>ãƒ­ã‚´ç”»åƒ:</label>
            <input type="text" id="hostTeamLogo" placeholder="ãƒ­ã‚´ç”»åƒã®URL" readonly>
            <button onclick="loadTeamLogo('hostTeam')" style="margin-top: 5px;">ğŸ–¼ï¸ ç”»åƒã‚’é¸æŠ</button>
          </div>
          <div class="form-group">
            <label>ãƒãƒ¼ãƒ ã‚«ãƒ©ãƒ¼:</label>
            <div style="display: flex; gap: 10px; align-items: center;">
              <input type="color" id="hostTeamColorPicker" style="width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 5px; cursor: pointer;">
              <input type="text" id="hostTeamColor" placeholder="#FF0000" style="flex: 1;">
            </div>
          </div>
          <div class="form-group">
            <label>ã‚¹ã‚³ã‚¢æ“ä½œ:</label>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
              <button onclick="addScore('host', 'try')" style="flex: 1; min-width: 100px; padding: 10px; font-weight: bold;">ğŸ‰ ãƒˆãƒ©ã‚¤ +5</button>
              <button onclick="addScore('host', 'conversion')" style="flex: 1; min-width: 100px; padding: 10px; font-weight: bold;">âš½ CG +2</button>
              <button onclick="addScore('host', 'penalty')" style="flex: 1; min-width: 100px; padding: 10px; font-weight: bold;">ğŸ¯ PG +3</button>
              <button onclick="addScore('host', 'drop')" style="flex: 1; min-width: 100px; padding: 10px; font-weight: bold;">ğŸ’¨ DG +3</button>
            </div>
            <div style="margin-top: 10px; font-size: 1.5em; font-weight: bold; text-align: center;">
              ã‚¹ã‚³ã‚¢: <span id="hostScoreDisplay">0</span>
            </div>
            <div style="margin-top: 5px; font-size: 0.9em; color: #666; text-align: center;">
              TRY:<span id="hostTriesDisplay">0</span> CG:<span id="hostConversionsDisplay">0</span> 
              PG:<span id="hostPGDisplay">0</span> DG:<span id="hostDGDisplay">0</span>
            </div>
          </div>
        </div>

        <!-- ã‚¢ã‚¦ã‚§ã‚¤ãƒãƒ¼ãƒ  -->
        <div class="team-section">
          <h3>ã‚¢ã‚¦ã‚§ã‚¤ãƒãƒ¼ãƒ </h3>
          <div class="form-group">
            <label>ãƒãƒ¼ãƒ å:</label>
            <input type="text" id="awayTeamName" placeholder="ãƒãƒ¼ãƒ åã‚’å…¥åŠ›">
          </div>
          <div class="form-group">
            <label>ãƒ­ã‚´ç”»åƒ:</label>
            <input type="text" id="awayTeamLogo" placeholder="ãƒ­ã‚´ç”»åƒã®URL" readonly>
            <button onclick="loadTeamLogo('awayTeam')" style="margin-top: 5px;">ğŸ–¼ï¸ ç”»åƒã‚’é¸æŠ</button>
          </div>
          <div class="form-group">
            <label>ãƒãƒ¼ãƒ ã‚«ãƒ©ãƒ¼:</label>
            <div style="display: flex; gap: 10px; align-items: center;">
              <input type="color" id="awayTeamColorPicker" style="width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 5px; cursor: pointer;">
              <input type="text" id="awayTeamColor" placeholder="#0000FF" style="flex: 1;">
            </div>
          </div>
          <div class="form-group">
            <label>ã‚¹ã‚³ã‚¢æ“ä½œ:</label>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
              <button onclick="addScore('away', 'try')" style="flex: 1; min-width: 100px; padding: 10px; font-weight: bold;">ğŸ‰ ãƒˆãƒ©ã‚¤ +5</button>
              <button onclick="addScore('away', 'conversion')" style="flex: 1; min-width: 100px; padding: 10px; font-weight: bold;">âš½ CG +2</button>
              <button onclick="addScore('away', 'penalty')" style="flex: 1; min-width: 100px; padding: 10px; font-weight: bold;">ğŸ¯ PG +3</button>
              <button onclick="addScore('away', 'drop')" style="flex: 1; min-width: 100px; padding: 10px; font-weight: bold;">ğŸ’¨ DG +3</button>
            </div>
            <div style="margin-top: 10px; font-size: 1.5em; font-weight: bold; text-align: center;">
              ã‚¹ã‚³ã‚¢: <span id="awayScoreDisplay">0</span>
            </div>
            <div style="margin-top: 5px; font-size: 0.9em; color: #666; text-align: center;">
              TRY:<span id="awayTriesDisplay">0</span> CG:<span id="awayConversionsDisplay">0</span> 
              PG:<span id="awayPGDisplay">0</span> DG:<span id="awayDGDisplay">0</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- é¸æ‰‹æƒ…å ± -->
    <div class="control-panel">
      <h2 class="section-title">é¸æ‰‹æƒ…å ±ç®¡ç†</h2>
      <div class="teams-container">
        <!-- ãƒ›ãƒ¼ãƒ ãƒãƒ¼ãƒ é¸æ‰‹ -->
        <div class="team-section">
          <h3>ãƒ›ãƒ¼ãƒ ãƒãƒ¼ãƒ é¸æ‰‹</h3>
          <div class="csv-section">
            <button onclick="loadTeamCSV('host')">ğŸ“„ CSVèª­ã¿è¾¼ã¿</button>
            <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
              CSVå½¢å¼: èƒŒç•ªå·,åå‰,ãƒã‚¸ã‚·ãƒ§ãƒ³
            </p>
            <div class="players-list" id="hostPlayers">
              <p style="color: #999;">é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“</p>
            </div>
          </div>
        </div>

        <!-- ã‚¢ã‚¦ã‚§ã‚¤ãƒãƒ¼ãƒ é¸æ‰‹ -->
        <div class="team-section">
          <h3>ã‚¢ã‚¦ã‚§ã‚¤ãƒãƒ¼ãƒ é¸æ‰‹</h3>
          <div class="csv-section">
            <button onclick="loadTeamCSV('away')">ğŸ“„ CSVèª­ã¿è¾¼ã¿</button>
            <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
              CSVå½¢å¼: èƒŒç•ªå·,åå‰,ãƒã‚¸ã‚·ãƒ§ãƒ³
            </p>
            <div class="players-list" id="awayPlayers">
              <p style="color: #999;">é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- é¸æ‰‹äº¤ä»£ -->
    <div class="control-panel">
      <h2 class="section-title">é¸æ‰‹äº¤ä»£</h2>
      <div class="substitution-section">
        <div class="teams-container">
          <div>
            <h3>ãƒ›ãƒ¼ãƒ ãƒãƒ¼ãƒ äº¤ä»£</h3>
            <div class="sub-controls">
              <div class="form-group">
                <label>OUT (äº¤ä»£ã™ã‚‹é¸æ‰‹):</label>
                <select id="hostOutNumber" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 1em;">
                  <option value="">é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                </select>
              </div>
              <div class="form-group">
                <label>IN (æŠ•å…¥ã™ã‚‹é¸æ‰‹):</label>
                <select id="hostInNumber" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 1em;">
                  <option value="">é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                </select>
              </div>
              <button onclick="substitutePlayer('host')">äº¤ä»£</button>
            </div>
          </div>
          <div>
            <h3>ã‚¢ã‚¦ã‚§ã‚¤ãƒãƒ¼ãƒ äº¤ä»£</h3>
            <div class="sub-controls">
              <div class="form-group">
                <label>OUT (äº¤ä»£ã™ã‚‹é¸æ‰‹):</label>
                <select id="awayOutNumber" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 1em;">
                  <option value="">é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                </select>
              </div>
              <div class="form-group">
                <label>IN (æŠ•å…¥ã™ã‚‹é¸æ‰‹):</label>
                <select id="awayInNumber" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 1em;">
                  <option value="">é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                </select>
              </div>
              <button onclick="substitutePlayer('away')">äº¤ä»£</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="control-panel">
      <div class="quick-actions">
        <button class="action-btn" onclick="toggleDisplayWindow()">ğŸ“º è¡¨ç¤ºç”»é¢ ON/OFF</button>
        <button class="action-btn" onclick="toggleScoreboardWindow()">ğŸ¬ é€éã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ ON/OFF</button>
        <button class="action-btn" onclick="toggleScoreboardChromakeyWindow()">ğŸ¥ ã‚¯ãƒ­ãƒã‚­ãƒ¼ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ ON/OFF</button>
        <button class="action-btn secondary" onclick="resetMatch()">ğŸ”„ è©¦åˆãƒªã‚»ãƒƒãƒˆ</button>
      </div>
      <div class="status-bar">
        âœ… ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒä¸­ - è¡¨ç¤ºç”»é¢ã¨åŒæœŸã•ã‚Œã¦ã„ã¾ã™
      </div>
    </div>
  </div>

  <script>
    let currentData = null;
    let currentHalf = 'first'; // 'first' or 'second'
    let halfScores = {
      first: { host: 0, away: 0 },
      second: { host: 0, away: 0 }
    };

    // å‰åŠ/å¾ŒåŠåˆ‡ã‚Šæ›¿ãˆ
    async function switchHalf(half) {
      currentHalf = half;
      document.getElementById('currentHalfDisplay').textContent = half === 'first' ? 'å‰åŠ' : 'å¾ŒåŠ';
      document.getElementById('halfBtn1').style.background = half === 'first' ? '#667eea' : '#6c757d';
      document.getElementById('halfBtn2').style.background = half === 'second' ? '#667eea' : '#6c757d';
      
      // ã‚µãƒ¼ãƒãƒ¼å´ã«ã‚‚é€šçŸ¥
      await window.electronAPI.switchHalf(half);
    }

    // ã‚¹ã‚³ã‚¢åŠ ç®—
    async function addScore(team, type) {
      let points = 0;
      let statKey = '';
      
      switch(type) {
        case 'try':
          points = 5;
          statKey = 'tries';
          break;
        case 'conversion':
          points = 2;
          statKey = 'conversions';
          break;
        case 'penalty':
          points = 3;
          statKey = 'penaltyGoals';
          break;
        case 'drop':
          points = 3;
          statKey = 'dropGoals';
          break;
      }
      
      // ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      const data = await window.electronAPI.getMatchData();
      
      // å‰åŠ/å¾ŒåŠã®çµ±è¨ˆã‚’æ›´æ–°
      const currentStat = data.stats[team][currentHalf][statKey];
      await window.electronAPI.updateHalfStats(currentHalf, team, statKey, currentStat + 1);
      
      // å‰åŠ/å¾ŒåŠã‚¹ã‚³ã‚¢ã‚’æ›´æ–°
      halfScores[currentHalf][team] += points;
      document.getElementById(`${team}${currentHalf === 'first' ? 'First' : 'Second'}HalfScore`).textContent = halfScores[currentHalf][team];
      await window.electronAPI.updateHalfScore(currentHalf, team, halfScores[currentHalf][team]);
      
      // è¡¨ç¤ºã‚’æ›´æ–°
      await loadData();
    }

    // åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    async function loadData() {
      currentData = await window.electronAPI.getMatchData();
      updateUI();
    }

    // UIã‚’æ›´æ–°
    function updateUI() {
      if (!currentData) return;

      document.getElementById('hostTeamName').value = currentData.hostTeam.name;
      document.getElementById('hostTeamLogo').value = currentData.hostTeam.logo;
      document.getElementById('hostTeamColor').value = currentData.hostTeam.color;
      document.getElementById('hostTeamColorPicker').value = currentData.hostTeam.color;
      document.getElementById('hostScoreDisplay').textContent = currentData.score.host;
      document.getElementById('hostTriesDisplay').textContent = currentData.stats.host.tries;
      document.getElementById('hostConversionsDisplay').textContent = currentData.stats.host.conversions;
      document.getElementById('hostPGDisplay').textContent = currentData.stats.host.penaltyGoals;
      document.getElementById('hostDGDisplay').textContent = currentData.stats.host.dropGoals || 0;

      document.getElementById('awayTeamName').value = currentData.awayTeam.name;
      document.getElementById('awayTeamLogo').value = currentData.awayTeam.logo;
      document.getElementById('awayTeamColor').value = currentData.awayTeam.color;
      document.getElementById('awayTeamColorPicker').value = currentData.awayTeam.color;
      document.getElementById('awayScoreDisplay').textContent = currentData.score.away;
      document.getElementById('awayTriesDisplay').textContent = currentData.stats.away.tries;
      document.getElementById('awayConversionsDisplay').textContent = currentData.stats.away.conversions;
      document.getElementById('awayPGDisplay').textContent = currentData.stats.away.penaltyGoals;
      document.getElementById('awayDGDisplay').textContent = currentData.stats.away.dropGoals || 0;

      updatePlayersList('host', currentData.players.host);
      updatePlayersList('away', currentData.players.away);
    }

    // é¸æ‰‹ãƒªã‚¹ãƒˆè¡¨ç¤º
    function updatePlayersList(team, players) {
      const container = document.getElementById(`${team}Players`);
      if (players.length === 0) {
        container.innerHTML = '<p style="color: #999;">é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“</p>';
        return;
      }

      container.innerHTML = players.map(p => `
        <div class="player-item">
          <span><span class="player-number">${p.number}</span>${p.name}</span>
          <span style="color: #666;">${p.position}</span>
        </div>
      `).join('');
      
      // äº¤ä»£ç”¨ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒªã‚¹ãƒˆã‚’æ›´æ–°
      updateSubstitutionDropdowns(team, players);
    }
    
    // äº¤ä»£ç”¨ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒªã‚¹ãƒˆã‚’æ›´æ–°
    function updateSubstitutionDropdowns(team, players) {
      const outSelect = document.getElementById(`${team}OutNumber`);
      const inSelect = document.getElementById(`${team}InNumber`);
      
      // OUTé¸æ‰‹ï¼ˆé…åˆ—ã®æœ€åˆã®15äºº = ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã„ã‚‹é¸æ‰‹ï¼‰
      const onFieldPlayers = players.slice(0, 15);
      outSelect.innerHTML = '<option value="">äº¤ä»£ã™ã‚‹é¸æ‰‹ã‚’é¸æŠ</option>' + 
        onFieldPlayers.map(p => `<option value="${p.number}">${p.number}. ${p.position} ${p.name}</option>`).join('');
      
      // INé¸æ‰‹ï¼ˆé…åˆ—ã®16äººç›®ä»¥é™ = ãƒªã‚¶ãƒ¼ãƒ–ã«ã„ã‚‹é¸æ‰‹ï¼‰
      const reservePlayers = players.slice(15);
      inSelect.innerHTML = '<option value="">æŠ•å…¥ã™ã‚‹é¸æ‰‹ã‚’é¸æŠ</option>' + 
        reservePlayers.map(p => `<option value="${p.number}">${p.number}. ${p.position} ${p.name}</option>`).join('');
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
    function setupEventListeners() {
      // ãƒãƒ¼ãƒ å
      document.getElementById('hostTeamName').addEventListener('change', (e) => {
        window.electronAPI.updateTeam('hostTeam', 'name', e.target.value);
      });
      document.getElementById('awayTeamName').addEventListener('change', (e) => {
        window.electronAPI.updateTeam('awayTeam', 'name', e.target.value);
      });

      // ãƒ­ã‚´URL
      document.getElementById('hostTeamLogo').addEventListener('change', (e) => {
        window.electronAPI.updateTeam('hostTeam', 'logo', e.target.value);
      });
      document.getElementById('awayTeamLogo').addEventListener('change', (e) => {
        window.electronAPI.updateTeam('awayTeam', 'logo', e.target.value);
      });

      // ãƒãƒ¼ãƒ ã‚«ãƒ©ãƒ¼ï¼ˆãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ï¼‰
      document.getElementById('hostTeamColor').addEventListener('input', (e) => {
        document.getElementById('hostTeamColorPicker').value = e.target.value;
        window.electronAPI.updateTeam('hostTeam', 'color', e.target.value);
      });
      document.getElementById('awayTeamColor').addEventListener('input', (e) => {
        document.getElementById('awayTeamColorPicker').value = e.target.value;
        window.electronAPI.updateTeam('awayTeam', 'color', e.target.value);
      });
      
      // ãƒãƒ¼ãƒ ã‚«ãƒ©ãƒ¼ï¼ˆã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ï¼‰
      document.getElementById('hostTeamColorPicker').addEventListener('input', (e) => {
        document.getElementById('hostTeamColor').value = e.target.value;
        window.electronAPI.updateTeam('hostTeam', 'color', e.target.value);
      });
      document.getElementById('awayTeamColorPicker').addEventListener('input', (e) => {
        document.getElementById('awayTeamColor').value = e.target.value;
        window.electronAPI.updateTeam('awayTeam', 'color', e.target.value);
      });
    }

    // ãƒ­ã‚´ç”»åƒèª­ã¿è¾¼ã¿
    async function loadTeamLogo(team) {
      try {
        console.log(`=== ãƒ­ã‚´èª­ã¿è¾¼ã¿é–‹å§‹: ${team} ===`);
        const logoUrl = await window.electronAPI.loadLogo(team);
        console.log('å–å¾—ã—ãŸãƒ­ã‚´URL:', logoUrl);
        
        if (logoUrl) {
          const inputId = team === 'hostTeam' ? 'hostTeamLogo' : 'awayTeamLogo';
          document.getElementById(inputId).value = logoUrl;
          console.log('inputãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è¨­å®š:', inputId, logoUrl);
          
          // è¡¨ç¤ºç”»é¢ã‚’æ›´æ–°ã™ã‚‹ãŸã‚ã«æ˜ç¤ºçš„ã«updateTeamã‚’å‘¼ã³å‡ºã™
          console.log('updateTeamå‘¼ã³å‡ºã—ä¸­...');
          await window.electronAPI.updateTeam(team, 'logo', logoUrl);
          console.log('updateTeamå®Œäº†');
          
          // UIã‚’æœ€æ–°ã®çŠ¶æ…‹ã«æ›´æ–°
          console.log('loadDataå‘¼ã³å‡ºã—ä¸­...');
          await loadData();
          console.log('loadDataå®Œäº†');
          
          alert('ãƒ­ã‚´ç”»åƒã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
        } else {
          console.log('ãƒ­ã‚´URLãŒnullã§ã™ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ãŸå¯èƒ½æ€§ï¼‰');
        }
      } catch (error) {
        console.error('ãƒ­ã‚´èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
        alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
      }
    }

    // CSVèª­ã¿è¾¼ã¿
    async function loadTeamCSV(team) {
      const players = await window.electronAPI.loadCSV(team);
      if (players) {
        updatePlayersList(team, players);
        alert(`${players.length}åã®é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`);
      }
    }

    // é¸æ‰‹äº¤ä»£
    async function substitutePlayer(team) {
      const outNumber = document.getElementById(`${team}OutNumber`).value;
      const inNumber = document.getElementById(`${team}InNumber`).value;
      
      if (!outNumber || !inNumber) {
        alert('äº¤ä»£é¸æ‰‹ã¨æŠ•å…¥é¸æ‰‹ã®èƒŒç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }

      try {
        await window.electronAPI.substitutePlayer(team, outNumber, inNumber);
        // äº¤ä»£å¾Œã«ãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦é¸æ‰‹ãƒªã‚¹ãƒˆã‚’æ›´æ–°
        await loadData();
        alert('é¸æ‰‹äº¤ä»£ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ');
        document.getElementById(`${team}OutNumber`).value = '';
        document.getElementById(`${team}InNumber`).value = '';
      } catch (error) {
        console.error('äº¤ä»£ã‚¨ãƒ©ãƒ¼:', error);
        alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
      }
    }

    // è¡¨ç¤ºç”»é¢ã®é–‹é–‰
    async function toggleDisplayWindow() {
      await window.electronAPI.toggleDisplay();
    }

    // ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ã®é–‹é–‰
    async function toggleScoreboardWindow() {
      await window.electronAPI.toggleScoreboard();
    }

    // ã‚¯ãƒ­ãƒã‚­ãƒ¼ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ã®é–‹é–‰
    async function toggleScoreboardChromakeyWindow() {
      await window.electronAPI.toggleScoreboardChromakey();
    }

    // è©¦åˆãƒªã‚»ãƒƒãƒˆ
    function resetMatch() {
      if (confirm('è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
        document.getElementById('hostScore').value = 0;
        document.getElementById('awayScore').value = 0;
        document.getElementById('hostTries').value = 0;
        document.getElementById('awayTries').value = 0;
        document.getElementById('hostConversions').value = 0;
        document.getElementById('awayConversions').value = 0;
        document.getElementById('hostPG').value = 0;
        document.getElementById('awayPG').value = 0;

        window.electronAPI.updateScore('host', 0);
        window.electronAPI.updateScore('away', 0);
        window.electronAPI.updateStats('host', 'tries', 0);
        window.electronAPI.updateStats('away', 'tries', 0);
        window.electronAPI.updateStats('host', 'conversions', 0);
        window.electronAPI.updateStats('away', 'conversions', 0);
        window.electronAPI.updateStats('host', 'penaltyGoals', 0);
        window.electronAPI.updateStats('away', 'penaltyGoals', 0);
      }
    }

    // åˆæœŸåŒ–
    window.addEventListener('DOMContentLoaded', () => {
      loadData();
      setupEventListeners();
    });
  </script>
</body>
</html>
