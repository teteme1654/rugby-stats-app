<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rugby Stats - ç®¡ç†ç”»é¢</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      color: white;
      text-align: center;
      margin-bottom: 30px;
      font-size: 2.5em;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .control-panel {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      margin-bottom: 20px;
    }

    .section-title {
      font-size: 1.5em;
      color: #667eea;
      margin-bottom: 20px;
      border-bottom: 3px solid #667eea;
      padding-bottom: 10px;
    }

    .teams-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }

    .team-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      border: 2px solid #e0e0e0;
    }

    .team-section h3 {
      margin-bottom: 15px;
      color: #333;
      font-size: 1.3em;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #555;
    }

    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 5px;
      font-size: 1em;
      transition: border-color 0.3s;
    }

    input:focus {
      outline: none;
      border-color: #667eea;
    }

    .score-input {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }

    .score-input input {
      text-align: center;
      font-size: 1.2em;
      font-weight: bold;
    }

    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1em;
      font-weight: bold;
      transition: all 0.3s;
      margin-right: 10px;
    }

    button:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    button.secondary {
      background: #6c757d;
    }

    button.secondary:hover {
      background: #5a6268;
    }

    .csv-section {
      margin-top: 20px;
    }

    .players-list {
      max-height: 300px;
      overflow-y: auto;
      background: white;
      border: 2px solid #ddd;
      border-radius: 5px;
      padding: 10px;
      margin-top: 10px;
    }

    .player-item {
      padding: 8px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
    }

    .player-item:last-child {
      border-bottom: none;
    }

    .player-number {
      font-weight: bold;
      color: #667eea;
      margin-right: 10px;
    }

    .substitution-section {
      background: #fff3cd;
      padding: 20px;
      border-radius: 10px;
      border: 2px solid #ffc107;
    }

    .sub-controls {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 10px;
      align-items: end;
    }

    .quick-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      justify-content: center;
    }

    .action-btn {
      padding: 15px 30px;
      font-size: 1.1em;
    }

    .status-bar {
      background: #28a745;
      color: white;
      padding: 10px;
      border-radius: 5px;
      text-align: center;
      margin-top: 20px;
      font-weight: bold;
    }

    /* é¸æ‰‹ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« */
    dialog {
      border: none;
      border-radius: 15px;
      padding: 0;
      box-shadow: 0 10px 50px rgba(0,0,0,0.3);
      min-width: 500px;
    }

    dialog::backdrop {
      background: rgba(0, 0, 0, 0.5);
    }

    .dialog-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 15px 15px 0 0;
    }

    .dialog-header h2 {
      margin: 0;
      font-size: 1.5em;
    }

    .dialog-body {
      padding: 20px;
    }

    .dialog-footer {
      padding: 20px;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      border-top: 1px solid #e0e0e0;
    }

    .edit-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9em;
      transition: background 0.3s;
    }

    .edit-btn:hover {
      background: #5568d3;
    }

    .player-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .player-item-info {
      flex: 1;
      display: flex;
      gap: 10px;
      align-items: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ‰ Rugby Stats Board - ç®¡ç†ç”»é¢</h1>

    <!-- å‰åŠ/å¾ŒåŠåˆ‡ã‚Šæ›¿ãˆ -->
    <div class="control-panel">
      <h2 class="section-title">è©¦åˆé€²è¡Œ</h2>
      <div style="display: flex; gap: 20px; align-items: center; justify-content: center;">
        <button id="halfBtn1" onclick="switchHalf('first')" style="padding: 15px 40px; font-size: 1.2em; background: #667eea;">å‰åŠ</button>
        <button id="halfBtn2" onclick="switchHalf('second')" style="padding: 15px 40px; font-size: 1.2em; background: #6c757d;">å¾ŒåŠ</button>
        <div style="margin-left: 20px;">
          <strong>ç¾åœ¨:</strong> <span id="currentHalfDisplay">å‰åŠ</span>
        </div>
      </div>
      <div style="margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
          <h3>å‰åŠã‚¹ã‚³ã‚¢</h3>
          <div style="font-size: 2em; font-weight: bold; margin-top: 10px;">
            <span id="hostFirstHalfScore">0</span> - <span id="awayFirstHalfScore">0</span>
          </div>
        </div>
        <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
          <h3>å¾ŒåŠã‚¹ã‚³ã‚¢</h3>
          <div style="font-size: 2em; font-weight: bold; margin-top: 10px;">
            <span id="hostSecondHalfScore">0</span> - <span id="awaySecondHalfScore">0</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ãƒãƒ¼ãƒ æƒ…å ±ãƒ»ã‚¹ã‚³ã‚¢ -->
    <div class="control-panel">
      <h2 class="section-title">ãƒãƒ¼ãƒ æƒ…å ±ãƒ»ã‚¹ã‚³ã‚¢</h2>
      <div class="teams-container">
        <!-- ãƒ›ãƒ¼ãƒ ãƒãƒ¼ãƒ  -->
        <div class="team-section">
          <h3>ãƒ›ãƒ¼ãƒ ãƒãƒ¼ãƒ </h3>
          <div class="form-group">
            <label>ãƒãƒ¼ãƒ å:</label>
            <input type="text" id="hostTeamName" placeholder="ãƒãƒ¼ãƒ åã‚’å…¥åŠ›">
          </div>
          <div class="form-group">
            <label>ãƒãƒ¼ãƒ åã‚µã‚¤ã‚º:</label>
            <div style="display: flex; align-items: center; gap: 10px;">
              <input type="range" id="hostTeamNameSizeSlider" min="1.0" max="3.5" step="0.1" value="2.0" 
                     style="flex: 1; cursor: pointer;">
              <span id="hostTeamNameSizeDisplay" style="min-width: 60px; font-weight: bold; text-align: right;">2.0em</span>
            </div>
          </div>
          <div class="form-group">
            <label>ãƒ­ã‚´ç”»åƒ:</label>
            <input type="text" id="hostTeamLogo" placeholder="ãƒ­ã‚´ç”»åƒã®URL" readonly>
            <button onclick="loadTeamLogo('hostTeam')" style="margin-top: 5px;">ğŸ–¼ï¸ ç”»åƒã‚’é¸æŠ</button>
          </div>
          <div class="form-group">
            <label>ãƒãƒ¼ãƒ ã‚«ãƒ©ãƒ¼:</label>
            <div style="display: flex; gap: 10px; align-items: center;">
              <input type="color" id="hostTeamColorPicker" style="width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 5px; cursor: pointer;">
              <input type="text" id="hostTeamColor" placeholder="#FF0000" style="flex: 1;">
            </div>
          </div>
          <div class="form-group">
            <label>ã‚¹ã‚³ã‚¢æ“ä½œ:</label>
            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;">
              <div style="display: flex; flex-direction: column; gap: 5px;">
                <div style="text-align: center; font-weight: bold; font-size: 0.9em; color: #333;">
                  ğŸ‰ ãƒˆãƒ©ã‚¤<br>
                  <span id="hostTriesCount" style="font-size: 1.2em; color: #667eea;">0</span>
                </div>
                <button onclick="addScore('host', 'try')" style="padding: 10px; font-weight: bold; background: #28a745; color: white;">+5</button>
                <button onclick="subtractScore('host', 'try')" style="padding: 5px; font-size: 0.9em; background: #dc3545; color: white;">-5</button>
              </div>
              <div style="display: flex; flex-direction: column; gap: 5px;">
                <div style="text-align: center; font-weight: bold; font-size: 0.9em; color: #333;">
                  âš½ CG<br>
                  <span id="hostConversionsCount" style="font-size: 1.2em; color: #667eea;">0</span>
                </div>
                <button onclick="addScore('host', 'conversion')" style="padding: 10px; font-weight: bold; background: #28a745; color: white;">+2</button>
                <button onclick="subtractScore('host', 'conversion')" style="padding: 5px; font-size: 0.9em; background: #dc3545; color: white;">-2</button>
              </div>
              <div style="display: flex; flex-direction: column; gap: 5px;">
                <div style="text-align: center; font-weight: bold; font-size: 0.9em; color: #333;">
                  ğŸ¯ PG<br>
                  <span id="hostPGCount" style="font-size: 1.2em; color: #667eea;">0</span>
                </div>
                <button onclick="addScore('host', 'penalty')" style="padding: 10px; font-weight: bold; background: #28a745; color: white;">+3</button>
                <button onclick="subtractScore('host', 'penalty')" style="padding: 5px; font-size: 0.9em; background: #dc3545; color: white;">-3</button>
              </div>
              <div style="display: flex; flex-direction: column; gap: 5px;">
                <div style="text-align: center; font-weight: bold; font-size: 0.9em; color: #333;">
                  ğŸ’¨ DG<br>
                  <span id="hostDGCount" style="font-size: 1.2em; color: #667eea;">0</span>
                </div>
                <button onclick="addScore('host', 'drop')" style="padding: 10px; font-weight: bold; background: #28a745; color: white;">+3</button>
                <button onclick="subtractScore('host', 'drop')" style="padding: 5px; font-size: 0.9em; background: #dc3545; color: white;">-3</button>
              </div>
              <div style="display: flex; flex-direction: column; gap: 5px;">
                <div style="text-align: center; font-weight: bold; font-size: 0.9em; color: #333;">
                  âš–ï¸ PT<br>
                  <span id="hostPTCount" style="font-size: 1.2em; color: #667eea;">0</span>
                </div>
                <button onclick="addScore('host', 'penaltyTry')" style="padding: 10px; font-weight: bold; background: #28a745; color: white;">+7</button>
                <button onclick="subtractScore('host', 'penaltyTry')" style="padding: 5px; font-size: 0.9em; background: #dc3545; color: white;">-7</button>
              </div>
            </div>
            <div style="margin-top: 10px; font-size: 1.5em; font-weight: bold; text-align: center;">
              ã‚¹ã‚³ã‚¢: <span id="hostScoreDisplay">0</span>
            </div>
          </div>
        </div>

        <!-- ã‚¢ã‚¦ã‚§ã‚¤ãƒãƒ¼ãƒ  -->
        <div class="team-section">
          <h3>ã‚¢ã‚¦ã‚§ã‚¤ãƒãƒ¼ãƒ </h3>
          <div class="form-group">
            <label>ãƒãƒ¼ãƒ å:</label>
            <input type="text" id="awayTeamName" placeholder="ãƒãƒ¼ãƒ åã‚’å…¥åŠ›">
          </div>
          <div class="form-group">
            <label>ãƒãƒ¼ãƒ åã‚µã‚¤ã‚º:</label>
            <div style="display: flex; align-items: center; gap: 10px;">
              <input type="range" id="awayTeamNameSizeSlider" min="1.0" max="3.5" step="0.1" value="2.0" 
                     style="flex: 1; cursor: pointer;">
              <span id="awayTeamNameSizeDisplay" style="min-width: 60px; font-weight: bold; text-align: right;">2.0em</span>
            </div>
          </div>
          <div class="form-group">
            <label>ãƒ­ã‚´ç”»åƒ:</label>
            <input type="text" id="awayTeamLogo" placeholder="ãƒ­ã‚´ç”»åƒã®URL" readonly>
            <button onclick="loadTeamLogo('awayTeam')" style="margin-top: 5px;">ğŸ–¼ï¸ ç”»åƒã‚’é¸æŠ</button>
          </div>
          <div class="form-group">
            <label>ãƒãƒ¼ãƒ ã‚«ãƒ©ãƒ¼:</label>
            <div style="display: flex; gap: 10px; align-items: center;">
              <input type="color" id="awayTeamColorPicker" style="width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 5px; cursor: pointer;">
              <input type="text" id="awayTeamColor" placeholder="#0000FF" style="flex: 1;">
            </div>
          </div>
          <div class="form-group">
            <label>ã‚¹ã‚³ã‚¢æ“ä½œ:</label>
            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;">
              <div style="display: flex; flex-direction: column; gap: 5px;">
                <div style="text-align: center; font-weight: bold; font-size: 0.9em; color: #333;">
                  ğŸ‰ ãƒˆãƒ©ã‚¤<br>
                  <span id="awayTriesCount" style="font-size: 1.2em; color: #667eea;">0</span>
                </div>
                <button onclick="addScore('away', 'try')" style="padding: 10px; font-weight: bold; background: #28a745; color: white;">+5</button>
                <button onclick="subtractScore('away', 'try')" style="padding: 5px; font-size: 0.9em; background: #dc3545; color: white;">-5</button>
              </div>
              <div style="display: flex; flex-direction: column; gap: 5px;">
                <div style="text-align: center; font-weight: bold; font-size: 0.9em; color: #333;">
                  âš½ CG<br>
                  <span id="awayConversionsCount" style="font-size: 1.2em; color: #667eea;">0</span>
                </div>
                <button onclick="addScore('away', 'conversion')" style="padding: 10px; font-weight: bold; background: #28a745; color: white;">+2</button>
                <button onclick="subtractScore('away', 'conversion')" style="padding: 5px; font-size: 0.9em; background: #dc3545; color: white;">-2</button>
              </div>
              <div style="display: flex; flex-direction: column; gap: 5px;">
                <div style="text-align: center; font-weight: bold; font-size: 0.9em; color: #333;">
                  ğŸ¯ PG<br>
                  <span id="awayPGCount" style="font-size: 1.2em; color: #667eea;">0</span>
                </div>
                <button onclick="addScore('away', 'penalty')" style="padding: 10px; font-weight: bold; background: #28a745; color: white;">+3</button>
                <button onclick="subtractScore('away', 'penalty')" style="padding: 5px; font-size: 0.9em; background: #dc3545; color: white;">-3</button>
              </div>
              <div style="display: flex; flex-direction: column; gap: 5px;">
                <div style="text-align: center; font-weight: bold; font-size: 0.9em; color: #333;">
                  ğŸ’¨ DG<br>
                  <span id="awayDGCount" style="font-size: 1.2em; color: #667eea;">0</span>
                </div>
                <button onclick="addScore('away', 'drop')" style="padding: 10px; font-weight: bold; background: #28a745; color: white;">+3</button>
                <button onclick="subtractScore('away', 'drop')" style="padding: 5px; font-size: 0.9em; background: #dc3545; color: white;">-3</button>
              </div>
              <div style="display: flex; flex-direction: column; gap: 5px;">
                <div style="text-align: center; font-weight: bold; font-size: 0.9em; color: #333;">
                  âš–ï¸ PT<br>
                  <span id="awayPTCount" style="font-size: 1.2em; color: #667eea;">0</span>
                </div>
                <button onclick="addScore('away', 'penaltyTry')" style="padding: 10px; font-weight: bold; background: #28a745; color: white;">+7</button>
                <button onclick="subtractScore('away', 'penaltyTry')" style="padding: 5px; font-size: 0.9em; background: #dc3545; color: white;">-7</button>
              </div>
            </div>
            <div style="margin-top: 10px; font-size: 1.5em; font-weight: bold; text-align: center;">
              ã‚¹ã‚³ã‚¢: <span id="awayScoreDisplay">0</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- é¸æ‰‹æƒ…å ± -->
    <div class="control-panel">
      <h2 class="section-title">é¸æ‰‹æƒ…å ±ç®¡ç†</h2>
      <div class="teams-container">
        <!-- ãƒ›ãƒ¼ãƒ ãƒãƒ¼ãƒ é¸æ‰‹ -->
        <div class="team-section">
          <h3>ãƒ›ãƒ¼ãƒ ãƒãƒ¼ãƒ é¸æ‰‹</h3>
          <div class="csv-section">
            <button onclick="loadTeamCSV('host')">ğŸ“„ CSVèª­ã¿è¾¼ã¿</button>
            <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
              CSVå½¢å¼: èƒŒç•ªå·,åå‰,ãƒã‚¸ã‚·ãƒ§ãƒ³
            </p>
            <div class="players-list" id="hostPlayers">
              <p style="color: #999;">é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“</p>
            </div>
          </div>
        </div>

        <!-- ã‚¢ã‚¦ã‚§ã‚¤ãƒãƒ¼ãƒ é¸æ‰‹ -->
        <div class="team-section">
          <h3>ã‚¢ã‚¦ã‚§ã‚¤ãƒãƒ¼ãƒ é¸æ‰‹</h3>
          <div class="csv-section">
            <button onclick="loadTeamCSV('away')">ğŸ“„ CSVèª­ã¿è¾¼ã¿</button>
            <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
              CSVå½¢å¼: èƒŒç•ªå·,åå‰,ãƒã‚¸ã‚·ãƒ§ãƒ³
            </p>
            <div class="players-list" id="awayPlayers">
              <p style="color: #999;">é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- é¸æ‰‹äº¤ä»£ -->
    <div class="control-panel">
      <h2 class="section-title">é¸æ‰‹äº¤ä»£</h2>
      <div class="substitution-section">
        <div class="teams-container">
          <div>
            <h3>ãƒ›ãƒ¼ãƒ ãƒãƒ¼ãƒ äº¤ä»£</h3>
            <div class="sub-controls">
              <div class="form-group">
                <label>OUT (äº¤ä»£ã™ã‚‹é¸æ‰‹):</label>
                <select id="hostOutNumber" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 1em;">
                  <option value="">é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                </select>
              </div>
              <div class="form-group">
                <label>IN (æŠ•å…¥ã™ã‚‹é¸æ‰‹):</label>
                <select id="hostInNumber" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 1em;">
                  <option value="">é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                </select>
              </div>
              <button onclick="substitutePlayer('host')">äº¤ä»£</button>
            </div>
          </div>
          <div>
            <h3>ã‚¢ã‚¦ã‚§ã‚¤ãƒãƒ¼ãƒ äº¤ä»£</h3>
            <div class="sub-controls">
              <div class="form-group">
                <label>OUT (äº¤ä»£ã™ã‚‹é¸æ‰‹):</label>
                <select id="awayOutNumber" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 1em;">
                  <option value="">é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                </select>
              </div>
              <div class="form-group">
                <label>IN (æŠ•å…¥ã™ã‚‹é¸æ‰‹):</label>
                <select id="awayInNumber" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 1em;">
                  <option value="">é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                </select>
              </div>
              <button onclick="substitutePlayer('away')">äº¤ä»£</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤è¨­å®š -->
    <div class="control-panel">
      <h2 class="section-title">ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤è¨­å®š</h2>
      <div class="form-group">
        <label>æ¥ç¶šã•ã‚Œã¦ã„ã‚‹ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤:</label>
        <div id="displayList" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
          <p style="color: #999;">èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>
      </div>
      
      <div class="teams-container">
        <div class="form-group">
          <label>ğŸ“Š ã‚¹ã‚¿ãƒƒãƒ„è¡¨ç¤ºç”»é¢:</label>
          <select id="displayWindowSelect" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 1em;">
            <option value="">ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã‚’é¸æŠ</option>
          </select>
          <button onclick="applyDisplaySetting('display')" style="margin-top: 10px; width: 100%;">é©ç”¨</button>
        </div>
        
        <div class="form-group">
          <label>ğŸ¬ ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰:</label>
          <select id="scoreboardWindowSelect" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 1em;">
            <option value="">ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã‚’é¸æŠ</option>
          </select>
          <button onclick="applyDisplaySetting('scoreboard')" style="margin-top: 10px; width: 100%;">é©ç”¨</button>
        </div>
      </div>
    </div>

    <!-- ã‚¯ãƒ­ãƒã‚­ãƒ¼è‰²è¨­å®š -->
    <div class="control-panel">
      <h2 class="section-title">ã‚¯ãƒ­ãƒã‚­ãƒ¼è‰²è¨­å®š</h2>
      <div class="form-group">
        <label>ã‚¯ãƒ­ãƒã‚­ãƒ¼ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ã®èƒŒæ™¯è‰²:</label>
        <div style="display: flex; gap: 15px; margin-top: 10px;">
          <button onclick="setChromakeyColor('#00FF00')" style="flex: 1; padding: 15px; background: #00FF00; color: black; border: 2px solid #ddd; border-radius: 5px; cursor: pointer; font-weight: bold;">
            ã‚°ãƒªãƒ¼ãƒ³ (#00FF00)
          </button>
          <button onclick="setChromakeyColor('#0000FF')" style="flex: 1; padding: 15px; background: #0000FF; color: white; border: 2px solid #ddd; border-radius: 5px; cursor: pointer; font-weight: bold;">
            ãƒ–ãƒ«ãƒ¼ (#0000FF)
          </button>
          <button onclick="setChromakeyColor('#FF00FF')" style="flex: 1; padding: 15px; background: #FF00FF; color: white; border: 2px solid #ddd; border-radius: 5px; cursor: pointer; font-weight: bold;">
            ãƒã‚¼ãƒ³ã‚¿ (#FF00FF)
          </button>
        </div>
        <div style="margin-top: 15px; display: flex; gap: 10px; align-items: center;">
          <label>ã‚«ã‚¹ã‚¿ãƒ è‰²:</label>
          <input type="color" id="chromakeyColorPicker" value="#00FF00" style="width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 5px; cursor: pointer;">
          <button onclick="setChromakeyColor(document.getElementById('chromakeyColorPicker').value)" style="padding: 10px 20px;">ã‚«ã‚¹ã‚¿ãƒ è‰²ã‚’é©ç”¨</button>
        </div>
        <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
          ç¾åœ¨ã®è‰²: <span id="currentChromakeyColor" style="font-weight: bold;">#00FF00</span>
        </p>
      </div>
    </div>

    <!-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="control-panel">
      <div class="quick-actions">
        <button class="action-btn" onclick="openMapper()" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);">ğŸ“Š å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿å–ã‚Šè¾¼ã¿</button>
        <button class="action-btn" onclick="toggleDisplayWindow()">ğŸ“º è¡¨ç¤ºç”»é¢ ON/OFF</button>
        <button class="action-btn" onclick="toggleScoreboardWindow()">ğŸ¬ é€éã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ ON/OFF</button>
        <button class="action-btn" onclick="toggleScoreboardChromakeyWindow()">ğŸ¥ ã‚¯ãƒ­ãƒã‚­ãƒ¼ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ ON/OFF</button>
        <button class="action-btn secondary" onclick="resetMatch()">ğŸ”„ è©¦åˆãƒªã‚»ãƒƒãƒˆ</button>
      </div>
      <div class="status-bar">
        âœ… ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒä¸­ - è¡¨ç¤ºç”»é¢ã¨åŒæœŸã•ã‚Œã¦ã„ã¾ã™
      </div>
    </div>
  </div>

  <script>
    let currentData = null;
    let currentHalf = 'first'; // 'first' or 'second'
    let halfScores = {
      first: { host: 0, away: 0 },
      second: { host: 0, away: 0 }
    };

    // å‰åŠ/å¾ŒåŠåˆ‡ã‚Šæ›¿ãˆ
    async function switchHalf(half) {
      currentHalf = half;
      document.getElementById('currentHalfDisplay').textContent = half === 'first' ? 'å‰åŠ' : 'å¾ŒåŠ';
      document.getElementById('halfBtn1').style.background = half === 'first' ? '#667eea' : '#6c757d';
      document.getElementById('halfBtn2').style.background = half === 'second' ? '#667eea' : '#6c757d';
      
      // ã‚µãƒ¼ãƒãƒ¼å´ã«ã‚‚é€šçŸ¥
      await window.electronAPI.switchHalf(half);
    }

    // ã‚¹ã‚³ã‚¢åŠ ç®—
    async function addScore(team, type) {
      let points = 0;
      let statKey = '';
      
      switch(type) {
        case 'try':
          points = 5;
          statKey = 'tries';
          break;
        case 'conversion':
          points = 2;
          statKey = 'conversions';
          break;
        case 'penalty':
          points = 3;
          statKey = 'penaltyGoals';
          break;
        case 'drop':
          points = 3;
          statKey = 'dropGoals';
          break;
        case 'penaltyTry':
          points = 7;
          statKey = 'penaltyTries';
          break;
      }
      
      // ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      const data = await window.electronAPI.getMatchData();
      
      // å‰åŠ/å¾ŒåŠã®çµ±è¨ˆã‚’æ›´æ–°
      const currentStat = data.stats[team][currentHalf][statKey];
      await window.electronAPI.updateHalfStats(currentHalf, team, statKey, currentStat + 1);
      
      // å‰åŠ/å¾ŒåŠã‚¹ã‚³ã‚¢ã‚’æ›´æ–°
      halfScores[currentHalf][team] += points;
      document.getElementById(`${team}${currentHalf === 'first' ? 'First' : 'Second'}HalfScore`).textContent = halfScores[currentHalf][team];
      await window.electronAPI.updateHalfScore(currentHalf, team, halfScores[currentHalf][team]);
      
      // ã‚«ã‚¦ãƒ³ãƒˆè¡¨ç¤ºã‚’å…ˆã«æ›´æ–°ï¼ˆloadData()ã§ä¸Šæ›¸ãã•ã‚Œã‚‹å‰ã«ï¼‰
      const countIdMap = {
        'tries': `${team}TriesCount`,
        'conversions': `${team}ConversionsCount`,
        'penaltyGoals': `${team}PGCount`,
        'dropGoals': `${team}DGCount`,
        'penaltyTries': `${team}PTCount`
      };
      const countId = countIdMap[statKey];
      console.log('Updating count:', { team, statKey, countId });
      
      // è¡¨ç¤ºã‚’æ›´æ–°ï¼ˆã“ã®æ™‚ç‚¹ã§backendã®ãƒ‡ãƒ¼ã‚¿ãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹ï¼‰
      await loadData();
      
      // loadData()ã®å¾Œã¯ä¸è¦ï¼ˆupdateUI()ã§æ­£ã—ãæ›´æ–°ã•ã‚Œã‚‹ï¼‰
    }

    // ã‚¹ã‚³ã‚¢æ¸›ç®—ï¼ˆå–ã‚Šæ¶ˆã—ç”¨ï¼‰
    async function subtractScore(team, type) {
      let points = 0;
      let statKey = '';
      
      switch(type) {
        case 'try':
          points = 5;
          statKey = 'tries';
          break;
        case 'conversion':
          points = 2;
          statKey = 'conversions';
          break;
        case 'penalty':
          points = 3;
          statKey = 'penaltyGoals';
          break;
        case 'drop':
          points = 3;
          statKey = 'dropGoals';
          break;
        case 'penaltyTry':
          points = 7;
          statKey = 'penaltyTries';
          break;
      }
      
      // ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      const data = await window.electronAPI.getMatchData();
      
      // ç¾åœ¨ã®çµ±è¨ˆå€¤ã‚’ç¢ºèªï¼ˆãƒã‚¤ãƒŠã‚¹ã«ãªã‚‰ãªã„ã‚ˆã†ã«ï¼‰
      const currentStat = data.stats[team][currentHalf][statKey];
      if (currentStat <= 0) {
        alert('ã“ã‚Œä»¥ä¸Šæ¸›ã‚‰ã›ã¾ã›ã‚“ï¼ˆ0æœªæº€ã«ã¯ã§ãã¾ã›ã‚“ï¼‰');
        return;
      }
      
      // ç¾åœ¨ã®å‰åŠ/å¾ŒåŠã‚¹ã‚³ã‚¢ã‚’ç¢ºèª
      if (halfScores[currentHalf][team] < points) {
        alert('ã‚¹ã‚³ã‚¢ãŒä¸è¶³ã—ã¦ã„ã¾ã™ï¼ˆãƒã‚¤ãƒŠã‚¹ã«ã¯ã§ãã¾ã›ã‚“ï¼‰');
        return;
      }
      
      // å‰åŠ/å¾ŒåŠã®çµ±è¨ˆã‚’æ›´æ–°
      await window.electronAPI.updateHalfStats(currentHalf, team, statKey, currentStat - 1);
      
      // å‰åŠ/å¾ŒåŠã‚¹ã‚³ã‚¢ã‚’æ›´æ–°
      halfScores[currentHalf][team] -= points;
      document.getElementById(`${team}${currentHalf === 'first' ? 'First' : 'Second'}HalfScore`).textContent = halfScores[currentHalf][team];
      await window.electronAPI.updateHalfScore(currentHalf, team, halfScores[currentHalf][team]);
      
      // è¡¨ç¤ºã‚’æ›´æ–°ï¼ˆã“ã®æ™‚ç‚¹ã§backendã®ãƒ‡ãƒ¼ã‚¿ãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹ï¼‰
      await loadData();
      
      // loadData()ã®updateUI()ã§æ­£ã—ãæ›´æ–°ã•ã‚Œã‚‹
    }


    // åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    async function loadData() {
      console.log('loadData: Fetching match data...');
      currentData = await window.electronAPI.getMatchData();
      console.log('loadData: Received data:', currentData);
      updateUI();
      console.log('loadData: UI updated');
    }

    // UIã‚’æ›´æ–°
    function updateUI() {
      if (!currentData) return;

      console.log('updateUI: Updating with data:', {
        hostScore: currentData.score.host,
        awayScore: currentData.score.away,
        hostTries: currentData.stats.host.tries,
        awayTries: currentData.stats.away.tries
      });

      document.getElementById('hostTeamName').value = currentData.hostTeam.name;
      document.getElementById('hostTeamLogo').value = currentData.hostTeam.logo;
      document.getElementById('hostTeamColor').value = currentData.hostTeam.color;
      document.getElementById('hostTeamColorPicker').value = currentData.hostTeam.color;
      document.getElementById('hostScoreDisplay').textContent = currentData.score.host;
      
      // ãƒœã‚¿ãƒ³ä¸Šéƒ¨ã®ã‚«ã‚¦ãƒ³ãƒˆè¡¨ç¤ºã‚’æ›´æ–°
      document.getElementById('hostTriesCount').textContent = currentData.stats.host.tries;
      document.getElementById('hostConversionsCount').textContent = currentData.stats.host.conversions;
      document.getElementById('hostPGCount').textContent = currentData.stats.host.penaltyGoals;
      document.getElementById('hostDGCount').textContent = currentData.stats.host.dropGoals || 0;
      document.getElementById('hostPTCount').textContent = currentData.stats.host.penaltyTries || 0;

      document.getElementById('awayTeamName').value = currentData.awayTeam.name;
      document.getElementById('awayTeamLogo').value = currentData.awayTeam.logo;
      document.getElementById('awayTeamColor').value = currentData.awayTeam.color;
      document.getElementById('awayTeamColorPicker').value = currentData.awayTeam.color;
      document.getElementById('awayScoreDisplay').textContent = currentData.score.away;
      
      // ãƒœã‚¿ãƒ³ä¸Šéƒ¨ã®ã‚«ã‚¦ãƒ³ãƒˆè¡¨ç¤ºã‚’æ›´æ–°
      document.getElementById('awayTriesCount').textContent = currentData.stats.away.tries;
      document.getElementById('awayConversionsCount').textContent = currentData.stats.away.conversions;
      document.getElementById('awayPGCount').textContent = currentData.stats.away.penaltyGoals;
      document.getElementById('awayDGCount').textContent = currentData.stats.away.dropGoals || 0;
      document.getElementById('awayPTCount').textContent = currentData.stats.away.penaltyTries || 0;

      // å‰åŠ/å¾ŒåŠã‚¹ã‚³ã‚¢è¡¨ç¤ºã‚’æ›´æ–°
      if (currentData.halfScores) {
        halfScores.first.host = currentData.halfScores.first.host;
        halfScores.first.away = currentData.halfScores.first.away;
        halfScores.second.host = currentData.halfScores.second.host;
        halfScores.second.away = currentData.halfScores.second.away;
        
        document.getElementById('hostFirstHalfScore').textContent = currentData.halfScores.first.host;
        document.getElementById('awayFirstHalfScore').textContent = currentData.halfScores.first.away;
        document.getElementById('hostSecondHalfScore').textContent = currentData.halfScores.second.host;
        document.getElementById('awaySecondHalfScore').textContent = currentData.halfScores.second.away;
      }

      updatePlayersList('host', currentData.players.host);
      updatePlayersList('away', currentData.players.away);
    }

    // é¸æ‰‹ãƒªã‚¹ãƒˆè¡¨ç¤º
    function updatePlayersList(team, players) {
      const container = document.getElementById(`${team}Players`);
      if (players.length === 0) {
        container.innerHTML = '<p style="color: #999;">é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“</p>';
        return;
      }

      container.innerHTML = players.map((p, index) => `
        <div class="player-item">
          <div class="player-item-info">
            <span><span class="player-number">${p.number}</span>${p.name}</span>
            <span style="color: #666;">${p.position}</span>
          </div>
          <button class="edit-btn" onclick="openEditPlayerDialog('${team}', ${index})">âœï¸ ç·¨é›†</button>
        </div>
      `).join('');
      
      // äº¤ä»£ç”¨ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒªã‚¹ãƒˆã‚’æ›´æ–°
      updateSubstitutionDropdowns(team, players);
    }
    
    // äº¤ä»£ç”¨ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒªã‚¹ãƒˆã‚’æ›´æ–°
    function updateSubstitutionDropdowns(team, players) {
      const outSelect = document.getElementById(`${team}OutNumber`);
      const inSelect = document.getElementById(`${team}InNumber`);
      
      // OUTé¸æ‰‹ï¼ˆé…åˆ—ã®æœ€åˆã®15äºº = ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã„ã‚‹é¸æ‰‹ï¼‰
      const onFieldPlayers = players.slice(0, 15);
      outSelect.innerHTML = '<option value="">äº¤ä»£ã™ã‚‹é¸æ‰‹ã‚’é¸æŠ</option>' + 
        onFieldPlayers.map(p => `<option value="${p.number}">${p.number}. ${p.position} ${p.name}</option>`).join('');
      
      // INé¸æ‰‹ï¼ˆé…åˆ—ã®16äººç›®ä»¥é™ = ãƒªã‚¶ãƒ¼ãƒ–ã«ã„ã‚‹é¸æ‰‹ï¼‰
      const reservePlayers = players.slice(15);
      inSelect.innerHTML = '<option value="">æŠ•å…¥ã™ã‚‹é¸æ‰‹ã‚’é¸æŠ</option>' + 
        reservePlayers.map(p => `<option value="${p.number}">${p.number}. ${p.position} ${p.name}</option>`).join('');
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
    function setupEventListeners() {
      // ãƒ›ãƒ¼ãƒ ãƒãƒ¼ãƒ åã‚µã‚¤ã‚ºã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
      document.getElementById('hostTeamNameSizeSlider').addEventListener('input', (e) => {
        const size = parseFloat(e.target.value);
        document.getElementById('hostTeamNameSizeDisplay').textContent = `${size.toFixed(1)}em`;
        window.electronAPI.updateTeamNameSize('host', size);
      });
      
      // ã‚¢ã‚¦ã‚§ã‚¤ãƒãƒ¼ãƒ åã‚µã‚¤ã‚ºã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
      document.getElementById('awayTeamNameSizeSlider').addEventListener('input', (e) => {
        const size = parseFloat(e.target.value);
        document.getElementById('awayTeamNameSizeDisplay').textContent = `${size.toFixed(1)}em`;
        window.electronAPI.updateTeamNameSize('away', size);
      });
      
      // ãƒãƒ¼ãƒ å
      document.getElementById('hostTeamName').addEventListener('change', (e) => {
        window.electronAPI.updateTeam('hostTeam', 'name', e.target.value);
      });
      document.getElementById('awayTeamName').addEventListener('change', (e) => {
        window.electronAPI.updateTeam('awayTeam', 'name', e.target.value);
      });

      // ãƒ­ã‚´URL
      document.getElementById('hostTeamLogo').addEventListener('change', (e) => {
        window.electronAPI.updateTeam('hostTeam', 'logo', e.target.value);
      });
      document.getElementById('awayTeamLogo').addEventListener('change', (e) => {
        window.electronAPI.updateTeam('awayTeam', 'logo', e.target.value);
      });

      // ãƒãƒ¼ãƒ ã‚«ãƒ©ãƒ¼ï¼ˆãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ï¼‰
      document.getElementById('hostTeamColor').addEventListener('input', (e) => {
        document.getElementById('hostTeamColorPicker').value = e.target.value;
        window.electronAPI.updateTeam('hostTeam', 'color', e.target.value);
      });
      document.getElementById('awayTeamColor').addEventListener('input', (e) => {
        document.getElementById('awayTeamColorPicker').value = e.target.value;
        window.electronAPI.updateTeam('awayTeam', 'color', e.target.value);
      });
      
      // ãƒãƒ¼ãƒ ã‚«ãƒ©ãƒ¼ï¼ˆã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ï¼‰
      document.getElementById('hostTeamColorPicker').addEventListener('input', (e) => {
        document.getElementById('hostTeamColor').value = e.target.value;
        window.electronAPI.updateTeam('hostTeam', 'color', e.target.value);
      });
      document.getElementById('awayTeamColorPicker').addEventListener('input', (e) => {
        document.getElementById('awayTeamColor').value = e.target.value;
        window.electronAPI.updateTeam('awayTeam', 'color', e.target.value);
      });
    }

    // ãƒ­ã‚´ç”»åƒèª­ã¿è¾¼ã¿
    async function loadTeamLogo(team) {
      try {
        console.log(`=== ãƒ­ã‚´èª­ã¿è¾¼ã¿é–‹å§‹: ${team} ===`);
        const logoUrl = await window.electronAPI.loadLogo(team);
        console.log('å–å¾—ã—ãŸãƒ­ã‚´URL:', logoUrl);
        
        if (logoUrl) {
          const inputId = team === 'hostTeam' ? 'hostTeamLogo' : 'awayTeamLogo';
          document.getElementById(inputId).value = logoUrl;
          console.log('inputãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è¨­å®š:', inputId, logoUrl);
          
          // è¡¨ç¤ºç”»é¢ã‚’æ›´æ–°ã™ã‚‹ãŸã‚ã«æ˜ç¤ºçš„ã«updateTeamã‚’å‘¼ã³å‡ºã™
          console.log('updateTeamå‘¼ã³å‡ºã—ä¸­...');
          await window.electronAPI.updateTeam(team, 'logo', logoUrl);
          console.log('updateTeamå®Œäº†');
          
          // UIã‚’æœ€æ–°ã®çŠ¶æ…‹ã«æ›´æ–°
          console.log('loadDataå‘¼ã³å‡ºã—ä¸­...');
          await loadData();
          console.log('loadDataå®Œäº†');
          
          alert('ãƒ­ã‚´ç”»åƒã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
        } else {
          console.log('ãƒ­ã‚´URLãŒnullã§ã™ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ãŸå¯èƒ½æ€§ï¼‰');
        }
      } catch (error) {
        console.error('ãƒ­ã‚´èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
        alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
      }
    }

    // CSVèª­ã¿è¾¼ã¿
    async function loadTeamCSV(team) {
      try {
        const result = await window.electronAPI.loadCSV(team);
        console.log('CSVèª­ã¿è¾¼ã¿çµæœ:', result);
        
        if (result) {
          let message = `âœ… ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ\n\n`;
          message += `é¸æ‰‹: ${result.players.length}å\n`;
          message += `ãƒãƒ¼ãƒ å: ${result.teamName}\n`;
          if (result.hasLogo) {
            message += `ãƒ­ã‚´: èª­ã¿è¾¼ã¿æˆåŠŸ`;
          } else {
            message += `ãƒ­ã‚´: ãªã—ï¼ˆã¾ãŸã¯æ›´æ–°ãªã—ï¼‰`;
          }
          alert(message);
          await loadData();
        } else {
          alert('âš ï¸ CSVèª­ã¿è¾¼ã¿ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸã‹ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
        }
      } catch (error) {
        console.error('CSVèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ï¼ˆcontrol.htmlï¼‰:', error);
        alert(`âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:\n${error.message}`);
      }
    }

    // é¸æ‰‹äº¤ä»£
    async function substitutePlayer(team) {
      const outNumber = document.getElementById(`${team}OutNumber`).value;
      const inNumber = document.getElementById(`${team}InNumber`).value;
      
      if (!outNumber || !inNumber) {
        alert('äº¤ä»£é¸æ‰‹ã¨æŠ•å…¥é¸æ‰‹ã®èƒŒç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }

      try {
        await window.electronAPI.substitutePlayer(team, outNumber, inNumber);
        // äº¤ä»£å¾Œã«ãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦é¸æ‰‹ãƒªã‚¹ãƒˆã‚’æ›´æ–°
        await loadData();
        alert('é¸æ‰‹äº¤ä»£ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ');
        document.getElementById(`${team}OutNumber`).value = '';
        document.getElementById(`${team}InNumber`).value = '';
      } catch (error) {
        console.error('äº¤ä»£ã‚¨ãƒ©ãƒ¼:', error);
        alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
      }
    }

    // è¡¨ç¤ºç”»é¢ã®é–‹é–‰
    async function toggleDisplayWindow() {
      await window.electronAPI.toggleDisplay();
    }

    // ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ã®é–‹é–‰
    async function toggleScoreboardWindow() {
      await window.electronAPI.toggleScoreboard();
    }

    // ã‚¯ãƒ­ãƒã‚­ãƒ¼ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ã®é–‹é–‰
    async function toggleScoreboardChromakeyWindow() {
      await window.electronAPI.toggleScoreboardChromakey();
    }

    // ãƒãƒƒãƒ‘ãƒ¼ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã
    async function openMapper() {
      await window.electronAPI.openMapper();
    }

    // è©¦åˆãƒªã‚»ãƒƒãƒˆ
    async function resetMatch() {
      if (confirm('è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
        // å‰åŠãƒ»å¾ŒåŠã®ã‚¹ã‚³ã‚¢ã‚’ãƒªã‚»ãƒƒãƒˆ
        halfScores.first.host = 0;
        halfScores.first.away = 0;
        halfScores.second.host = 0;
        halfScores.second.away = 0;
        
        // è¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆ
        document.getElementById('hostFirstHalfScore').textContent = 0;
        document.getElementById('hostSecondHalfScore').textContent = 0;
        document.getElementById('awayFirstHalfScore').textContent = 0;
        document.getElementById('awaySecondHalfScore').textContent = 0;
        
        // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚¹ã‚³ã‚¢ã¨çµ±è¨ˆã‚’ãƒªã‚»ãƒƒãƒˆ
        await window.electronAPI.updateScore('host', 0);
        await window.electronAPI.updateScore('away', 0);
        
        // å…¨ã¦ã®çµ±è¨ˆã‚’ãƒªã‚»ãƒƒãƒˆ
        const statKeys = ['tries', 'conversions', 'penaltyGoals', 'dropGoals', 'penaltyTries'];
        for (const key of statKeys) {
          await window.electronAPI.updateStats('host', key, 0);
          await window.electronAPI.updateStats('away', key, 0);
        }
        
        // å‰åŠãƒ»å¾ŒåŠã”ã¨ã®çµ±è¨ˆã‚‚ãƒªã‚»ãƒƒãƒˆ
        for (const half of ['first', 'second']) {
          for (const key of statKeys) {
            await window.electronAPI.updateHalfStats(half, 'host', key, 0);
            await window.electronAPI.updateHalfStats(half, 'away', key, 0);
          }
          await window.electronAPI.updateHalfScore(half, 'host', 0);
          await window.electronAPI.updateHalfScore(half, 'away', 0);
        }
        
        // UIã‚’æ›´æ–°
        await loadData();
        
        alert('è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚');
      }
    }

    // é¸æ‰‹ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
    function openEditPlayerDialog(team, playerIndex) {
      const dialog = document.getElementById('editPlayerDialog');
      const players = currentData.players[team];
      const player = players[playerIndex];

      // ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒãƒˆ
      document.getElementById('editTeam').value = team;
      document.getElementById('editPlayerIndex').value = playerIndex;
      document.getElementById('editPlayerNumber').value = player.number || '';
      document.getElementById('editPlayerName').value = player.name || '';
      document.getElementById('editPlayerPosition').value = player.position || '';
      document.getElementById('editPlayerImage').value = player.image || '';

      // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
      dialog.showModal();
    }

    // é¸æ‰‹æƒ…å ±ã‚’ä¿å­˜
    async function savePlayerEdit() {
      const team = document.getElementById('editTeam').value;
      const playerIndex = parseInt(document.getElementById('editPlayerIndex').value);
      const number = document.getElementById('editPlayerNumber').value.trim();
      const name = document.getElementById('editPlayerName').value.trim();
      const position = document.getElementById('editPlayerPosition').value.trim();
      const image = document.getElementById('editPlayerImage').value.trim();

      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      if (!name) {
        alert('é¸æ‰‹åã¯å¿…é ˆã§ã™ã€‚');
        return;
      }
      if (!number) {
        alert('èƒŒç•ªå·ã¯å¿…é ˆã§ã™ã€‚');
        return;
      }

      // æ›´æ–°ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
      const updatedPlayer = {
        number: number,
        name: name,
        position: position,
        image: image
      };

      try {
        // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«æ›´æ–°ã‚’é€ä¿¡
        await window.electronAPI.updatePlayer(team, playerIndex, updatedPlayer);
        
        // UIã‚’æ›´æ–°
        await loadData();
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        closeEditPlayerDialog();
        
        alert('é¸æ‰‹æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚');
      } catch (error) {
        console.error('é¸æ‰‹æƒ…å ±ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
        alert('é¸æ‰‹æƒ…å ±ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
      }
    }

    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
    function closeEditPlayerDialog() {
      const dialog = document.getElementById('editPlayerDialog');
      dialog.close();
    }

    // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
    async function selectPlayerImage() {
      try {
        const result = await window.electronAPI.selectImageFile();
        if (result && result.filePath) {
          document.getElementById('editPlayerImage').value = result.filePath;
        }
      } catch (error) {
        console.error('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
      }
    }

    // åˆæœŸåŒ–
    window.addEventListener('DOMContentLoaded', () => {
      loadData();
      setupEventListeners();
      loadDisplayList();
      loadChromakeyColor();
    });

    // ã‚¯ãƒ­ãƒã‚­ãƒ¼è‰²ã‚’è¨­å®š
    async function setChromakeyColor(color) {
      try {
        await window.electronAPI.setChromakeyColor(color);
        localStorage.setItem('chromakeyColor', color);
        document.getElementById('currentChromakeyColor').textContent = color;
        alert(`ã‚¯ãƒ­ãƒã‚­ãƒ¼è‰²ã‚’ ${color} ã«è¨­å®šã—ã¾ã—ãŸã€‚`);
      } catch (error) {
        console.error('ã‚¯ãƒ­ãƒã‚­ãƒ¼è‰²ã®è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
        alert('ã‚¯ãƒ­ãƒã‚­ãƒ¼è‰²ã®è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
      }
    }

    // ä¿å­˜ã•ã‚ŒãŸã‚¯ãƒ­ãƒã‚­ãƒ¼è‰²ã‚’èª­ã¿è¾¼ã‚€
    function loadChromakeyColor() {
      const savedColor = localStorage.getItem('chromakeyColor') || '#00FF00';
      document.getElementById('chromakeyColorPicker').value = savedColor;
      document.getElementById('currentChromakeyColor').textContent = savedColor;
    }

    // ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ä¸€è¦§ã‚’èª­ã¿è¾¼ã‚€
    async function loadDisplayList() {
      try {
        const displays = await window.electronAPI.getDisplays();
        
        // ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤æƒ…å ±ã‚’è¡¨ç¤º
        const displayListDiv = document.getElementById('displayList');
        displayListDiv.innerHTML = displays.map((d, index) => `
          <div style="padding: 10px; margin-bottom: 10px; background: white; border-radius: 5px; border: 2px solid ${d.primary ? '#667eea' : '#ddd'};">
            <strong>ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ ${index + 1} ${d.primary ? '(ãƒ¡ã‚¤ãƒ³)' : ''}</strong><br>
            <span style="color: #666; font-size: 0.9em;">
              è§£åƒåº¦: ${d.width} Ã— ${d.height} | ä½ç½®: (${d.x}, ${d.y})
            </span>
          </div>
        `).join('');
        
        // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
        const displaySelect = document.getElementById('displayWindowSelect');
        const scoreboardSelect = document.getElementById('scoreboardWindowSelect');
        
        const options = displays.map((d, index) => 
          `<option value="${index}">ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ ${index + 1} - ${d.width}Ã—${d.height} ${d.primary ? '(ãƒ¡ã‚¤ãƒ³)' : ''}</option>`
        ).join('');
        
        displaySelect.innerHTML = '<option value="">ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã‚’é¸æŠ</option>' + options;
        scoreboardSelect.innerHTML = '<option value="">ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã‚’é¸æŠ</option>' + options;
        
        // ä¿å­˜ã•ã‚ŒãŸè¨­å®šã‚’èª­ã¿è¾¼ã¿
        const savedDisplayIndex = localStorage.getItem('displayWindowIndex');
        const savedScoreboardIndex = localStorage.getItem('scoreboardWindowIndex');
        
        if (savedDisplayIndex !== null) {
          displaySelect.value = savedDisplayIndex;
        }
        if (savedScoreboardIndex !== null) {
          scoreboardSelect.value = savedScoreboardIndex;
        }
      } catch (error) {
        console.error('ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
        document.getElementById('displayList').innerHTML = '<p style="color: red;">ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
      }
    }

    // ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤è¨­å®šã‚’é©ç”¨
    async function applyDisplaySetting(windowType) {
      try {
        let selectElement, storageKey;
        
        if (windowType === 'display') {
          selectElement = document.getElementById('displayWindowSelect');
          storageKey = 'displayWindowIndex';
        } else if (windowType === 'scoreboard') {
          selectElement = document.getElementById('scoreboardWindowSelect');
          storageKey = 'scoreboardWindowIndex';
        }
        
        const displayIndex = selectElement.value;
        if (displayIndex === '') {
          alert('ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
          return;
        }
        
        // è¨­å®šã‚’ä¿å­˜
        localStorage.setItem(storageKey, displayIndex);
        
        // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«è¨­å®šã‚’é€ä¿¡
        await window.electronAPI.setDisplayForWindow(windowType, parseInt(displayIndex));
        
        alert(`${windowType === 'display' ? 'ã‚¹ã‚¿ãƒƒãƒ„è¡¨ç¤ºç”»é¢' : 'ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰'}ã®ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤è¨­å®šã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚\næ¬¡å›è¡¨ç¤ºæ™‚ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚`);
      } catch (error) {
        console.error('ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤è¨­å®šã®é©ç”¨ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
        alert('ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤è¨­å®šã®é©ç”¨ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
      }
    }
  </script>

  <!-- é¸æ‰‹ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <dialog id="editPlayerDialog">
    <div class="dialog-header">
      <h2>é¸æ‰‹æƒ…å ±ã®ç·¨é›†</h2>
    </div>
    <div class="dialog-body">
      <input type="hidden" id="editTeam">
      <input type="hidden" id="editPlayerIndex">
      
      <div class="form-group">
        <label for="editPlayerNumber">èƒŒç•ªå· *</label>
        <input type="text" id="editPlayerNumber" required>
      </div>
      
      <div class="form-group">
        <label for="editPlayerName">é¸æ‰‹å *</label>
        <input type="text" id="editPlayerName" required>
      </div>
      
      <div class="form-group">
        <label for="editPlayerPosition">ãƒã‚¸ã‚·ãƒ§ãƒ³</label>
        <input type="text" id="editPlayerPosition">
      </div>
      
      <div class="form-group">
        <label for="editPlayerImage">ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹</label>
        <div style="display: flex; gap: 10px;">
          <input type="text" id="editPlayerImage" style="flex: 1;">
          <button onclick="selectPlayerImage()" style="padding: 10px;">ğŸ“ é¸æŠ</button>
        </div>
      </div>
    </div>
    <div class="dialog-footer">
      <button onclick="closeEditPlayerDialog()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button onclick="savePlayerEdit()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">ä¿å­˜</button>
    </div>
  </dialog>
</body>
</html>
